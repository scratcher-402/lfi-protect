{% extends "base.html" %}

{% block title %}{{ note.title }} - –ó–ê–ú–ï–¢–ö–ò.–û–ù–õ–ê–ô–ù{% endblock %}

{% block content %}
<div class="note-view">
    <div class="note-header">
        <h2>{{ note.title }}</h2>
        <div class="note-actions">
            {% if can_edit %}
            <a href="{{ url_for('edit_note', note_id=note.id) }}" class="btn btn-secondary">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a>
            <a href="{{ url_for('share_note', note_id=note.id) }}" class="btn btn-secondary">–ü–æ–¥–µ–ª–∏—Ç—å—Å—è</a>
            <form action="{{ url_for('delete_note', note_id=note.id) }}" method="POST" 
                  onsubmit="return confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç—É –∑–∞–º–µ—Ç–∫—É?');"
                  style="display: inline;">
                <button type="submit" class="btn btn-danger">–£–¥–∞–ª–∏—Ç—å</button>
            </form>
            {% endif %}
        </div>
    </div>
    
    <div class="note-meta-info">
        <p><strong>–ê–≤—Ç–æ—Ä:</strong> {{ note.owner.username }}</p>
        <p><strong>–°–æ–∑–¥–∞–Ω–æ:</strong> {{ note.created_at.strftime('%d.%m.%Y %H:%M') }}</p>
        <p><strong>–û–±–Ω–æ–≤–ª–µ–Ω–æ:</strong> {{ note.updated_at.strftime('%d.%m.%Y %H:%M') }}</p>
    </div>
    
    <div class="note-content">
        {{ note.content|safe|replace('\n', '<br>') }}
    </div>
    
    {% if files %}
    <div class="note-files">
        <h3>–ü—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã</h3>
        <ul>
            {% for file in files %}
            <li>
                <a href="/download?filename={{file.unique_filename}}&user_id={{current_user.id}}&note_id={{note.id}}" class="file-link">
                    üìé {{ file.filename }}
                </a>
                {% if can_edit %}
                <a href="{{ url_for('delete_file', file_id=file.id) }}" 
                   onclick="return confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç —Ñ–∞–π–ª?');"
                   class="file-delete">üóëÔ∏è</a>
                {% endif %}
            </li>
            {% endfor %}
        </ul>
    </div>
    {% endif %}
    
    {% if shared_with and can_edit %}
    <div class="note-sharing">
        <h3>–î–æ—Å—Ç—É–ø –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω:</h3>
        <ul>
            {% for user in shared_with %}
            <li>
                {{ user.username }}
                <a href="{{ url_for('unshare_note', note_id=note.id, user_id=user.id) }}"
                   onclick="return confirm('–û—Ç–æ–∑–≤–∞—Ç—å –¥–æ—Å—Ç—É–ø —É {{ user.username }}?');"
                   class="unshare-link">–û—Ç–æ–∑–≤–∞—Ç—å –¥–æ—Å—Ç—É–ø</a>
            </li>
            {% endfor %}
        </ul>
    </div>
    {% endif %}
</div>
{% endblock %}
